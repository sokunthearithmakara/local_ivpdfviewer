define("local_ivpdfviewer/main",["exports","jquery","ivplugin_iframe/main"],(function(_exports,_jquery,_main){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * PDF viewer
   *
   * @module     local_ivpdfviewer/main
   * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_main=_interopRequireDefault(_main);class PdfViewer extends _main.default{renderContainer(annotation){(0,_jquery.default)("#message[data-id='".concat(annotation.id,"']")).addClass("hasiframe"),super.renderContainer(annotation)}async applyContent(annotation){let self=this;self.cache[annotation.id]&&!self.isEditMode()||(self.cache[annotation.id]=await this.render(annotation,"html"));const data=self.cache[annotation.id];(0,_jquery.default)("#message[data-id='".concat(annotation.id,"'] .modal-body")).attr("id","content").html(data).fadeIn(300),this.postContentRender(annotation),0==annotation.hascompletion||annotation.completed||("view"!=annotation.completiontracking?"scrolltolastpage"==annotation.completiontracking&&(annotation=>{const checkIframe=()=>{const iframe=document.querySelector("#message[data-id='".concat(annotation.id,"'] iframe"));let pdf;try{pdf=iframe.contentWindow.PDFViewerApplication.pdfViewer}catch(e){pdf=null}pdf&&pdf.pagesCount>0?1===pdf.pagesCount||1===pdf._pages.length?self.toggleCompletion(annotation.id,"mark-done","automatic"):pdf.eventBus.on("pagechanging",(function(e){e.pageNumber!=pdf.pagesCount||annotation.completed||(self.toggleCompletion(annotation.id,"mark-done","automatic"),annotation.completed=!0,pdf.eventBus.off("pagechanging"))})):requestAnimationFrame(checkIframe)};requestAnimationFrame(checkIframe)})(annotation):this.toggleCompletion(annotation.id,"mark-done","automatic"))}}return _exports.default=PdfViewer,_exports.default}));

//# sourceMappingURL=main.min.js.map